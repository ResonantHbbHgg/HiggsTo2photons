#include <vector>
#include <map>
#include <iostream>

#include "TH1F.h"
#include "TGraph.h"
#include "TCanvas.h"
#include "TString.h"

double GetBR(double mass) {

  map <double, double> BranchingRatioMap;
  BranchingRatioMap[90]=0.00123;
  BranchingRatioMap[95]=0.0014;
  BranchingRatioMap[100]=0.00159;
  BranchingRatioMap[105]=0.00178;
  BranchingRatioMap[110]=0.00197;
  BranchingRatioMap[110.5]=0.00199;
  BranchingRatioMap[111]=0.002;
  BranchingRatioMap[111.5]=0.00202;
  BranchingRatioMap[112]=0.00204;
  BranchingRatioMap[112.5]=0.00205;
  BranchingRatioMap[113]=0.00207;
  BranchingRatioMap[113.5]=0.00209;
  BranchingRatioMap[114]=0.0021;
  BranchingRatioMap[114.5]=0.00212;
  BranchingRatioMap[115]=0.00213;
  BranchingRatioMap[115.5]=0.00215;
  BranchingRatioMap[116]=0.00216;
  BranchingRatioMap[116.5]=0.00217;
  BranchingRatioMap[117]=0.00218;
  BranchingRatioMap[117.5]=0.0022;
  BranchingRatioMap[118]=0.00221;
  BranchingRatioMap[118.5]=0.00222;
  BranchingRatioMap[119]=0.00223;
  BranchingRatioMap[119.5]=0.00224;
  BranchingRatioMap[120]=0.00225;
  BranchingRatioMap[120.5]=0.00226;
  BranchingRatioMap[121]=0.00226;
  BranchingRatioMap[121.5]=0.00227;
  BranchingRatioMap[122]=0.00228;
  BranchingRatioMap[122.5]=0.00228;
  BranchingRatioMap[123]=0.00228;
  BranchingRatioMap[123.5]=0.00229;
  BranchingRatioMap[124]=0.00229;
  BranchingRatioMap[124.5]=0.00229;
  BranchingRatioMap[125]=0.00229;
  BranchingRatioMap[125.5]=0.00229;
  BranchingRatioMap[126]=0.00229;
  BranchingRatioMap[126.5]=0.00229;
  BranchingRatioMap[127]=0.00229;
  BranchingRatioMap[127.5]=0.00229;
  BranchingRatioMap[128]=0.00228;
  BranchingRatioMap[128.5]=0.00228;
  BranchingRatioMap[129]=0.00227;
  BranchingRatioMap[129.5]=0.00227;
  BranchingRatioMap[130]=0.00226;
  BranchingRatioMap[130.5]=0.00225;
  BranchingRatioMap[131]=0.00224;
  BranchingRatioMap[131.5]=0.00223;
  BranchingRatioMap[132]=0.00222;
  BranchingRatioMap[132.5]=0.00221;
  BranchingRatioMap[133]=0.00219;
  BranchingRatioMap[133.5]=0.00218;
  BranchingRatioMap[134]=0.00217;
  BranchingRatioMap[134.5]=0.00215;
  BranchingRatioMap[135]=0.00213;
  BranchingRatioMap[135.5]=0.00212;
  BranchingRatioMap[136]=0.0021;
  BranchingRatioMap[136.5]=0.00208;
  BranchingRatioMap[137]=0.00206;
  BranchingRatioMap[137.5]=0.00204;
  BranchingRatioMap[138]=0.00202;
  BranchingRatioMap[138.5]=0.002;
  BranchingRatioMap[139]=0.00198;
  BranchingRatioMap[139.5]=0.00196;
  BranchingRatioMap[140]=0.00193;
  BranchingRatioMap[141]=0.00189;
  BranchingRatioMap[142]=0.00184;
  BranchingRatioMap[143]=0.00178;
  BranchingRatioMap[144]=0.00173;
  BranchingRatioMap[145]=0.00167;
  BranchingRatioMap[146]=0.00162;
  BranchingRatioMap[147]=0.00156;
  BranchingRatioMap[148]=0.00149;
  BranchingRatioMap[149]=0.00143;
  BranchingRatioMap[150]=0.00136;
  BranchingRatioMap[151]=0.0013;
  BranchingRatioMap[152]=0.00123;
  BranchingRatioMap[153]=0.00115;
  BranchingRatioMap[154]=0.00108;
  BranchingRatioMap[155]=0.000999;
  BranchingRatioMap[156]=0.000914;
  BranchingRatioMap[157]=0.000825;
  BranchingRatioMap[158]=0.000729;
  BranchingRatioMap[159]=0.000628;
  BranchingRatioMap[160]=0.000532;
  BranchingRatioMap[162]=0.00037;
  BranchingRatioMap[164]=0.000259;
  BranchingRatioMap[166]=0.000208;
  BranchingRatioMap[168]=0.000178;
  BranchingRatioMap[170]=0.000158;
  BranchingRatioMap[172]=0.000143;
  BranchingRatioMap[174]=0.000132;
  BranchingRatioMap[176]=0.000122;
  BranchingRatioMap[178]=0.000113;
  BranchingRatioMap[180]=0.000105;
  BranchingRatioMap[182]=0.0000968;
  BranchingRatioMap[184]=0.0000881;
  BranchingRatioMap[186]=0.0000809;
  BranchingRatioMap[188]=0.0000752;
  BranchingRatioMap[190]=0.0000705;
  BranchingRatioMap[192]=0.0000666;
  BranchingRatioMap[194]=0.0000632;
  BranchingRatioMap[196]=0.0000602;
  BranchingRatioMap[198]=0.0000575;
  BranchingRatioMap[200]=0.0000551;
  BranchingRatioMap[202]=0.0000529;
  BranchingRatioMap[204]=0.0000508;
  BranchingRatioMap[206]=0.0000489;
  BranchingRatioMap[208]=0.0000471;
  BranchingRatioMap[210]=0.0000454;
  BranchingRatioMap[212]=0.0000439;
  BranchingRatioMap[214]=0.0000424;
  BranchingRatioMap[216]=0.000041;
  BranchingRatioMap[218]=0.0000396;
  BranchingRatioMap[220]=0.0000384;
  BranchingRatioMap[222]=0.0000372;
  BranchingRatioMap[224]=0.000036;
  BranchingRatioMap[226]=0.0000349;
  BranchingRatioMap[228]=0.0000339;
  BranchingRatioMap[230]=0.0000328;
  BranchingRatioMap[232]=0.0000319;
  BranchingRatioMap[234]=0.0000309;
  BranchingRatioMap[236]=0.0000301;
  BranchingRatioMap[238]=0.0000292;
  BranchingRatioMap[240]=0.0000284;
  BranchingRatioMap[242]=0.0000276;
  BranchingRatioMap[244]=0.0000268;
  BranchingRatioMap[246]=0.0000261;
  BranchingRatioMap[248]=0.0000254;
  BranchingRatioMap[250]=0.0000247;

  for (std::map<double, double>::const_iterator iter = BranchingRatioMap.begin();  iter != BranchingRatioMap.end(); ++iter) {
    if (mass==iter->first) return iter->second;
    if (mass>iter->first) {
      double lowmass = iter->first;
      double lowbr = iter->second;
      ++iter;
      if (mass<iter->first) {
        double highmass = iter->first;
        double highbr = iter->second;
        double br = (highbr-lowbr)/(highmass-lowmass)*(mass-lowmass)+lowbr;
        return br;
      }
      --iter;
    }
  }
  
  std::cout << "Warning branching ratio outside range of 90-250GeV!!!!" << std::endl;
  exit(1);
  
}

double GetXsection(double mass, TString HistName) {

  map <double, double> XSectionMap;
  if (HistName.Contains("ggh")) {
    XSectionMap[80]=46.0593;
    XSectionMap[81]=44.9777;
    XSectionMap[82]=43.9344;
    XSectionMap[83]=42.928; 
    XSectionMap[84]=41.9566;
    XSectionMap[85]=41.0179;
    XSectionMap[86]=40.1112;
    XSectionMap[87]=39.2347;
    XSectionMap[88]=38.3868;
    XSectionMap[89]=37.5664;
    XSectionMap[90]=36.7719;
    XSectionMap[91]=36.0024;
    XSectionMap[92]=35.2565;
    XSectionMap[93]=34.5342;
    XSectionMap[94]=33.833; 
    XSectionMap[95]=33.1525;
    XSectionMap[96]=32.4924;
    XSectionMap[97]=31.8511;
    XSectionMap[98]=31.2283;
    XSectionMap[99]=30.6236;
    XSectionMap[100]=30.0891;
    XSectionMap[101]=29.5154;
    XSectionMap[102]=28.9585;
    XSectionMap[103]=28.4107;
    XSectionMap[104]=27.8856;
    XSectionMap[105]=27.3602;
    XSectionMap[106]=26.8628;
    XSectionMap[107]=26.3911;
    XSectionMap[108]=25.9199;
    XSectionMap[109]=25.4603;
    XSectionMap[110]=25.0119;
    XSectionMap[110.5]=24.7918;
    XSectionMap[111]=24.5743;
    XSectionMap[111.5]=24.3597;
    XSectionMap[112]=24.1486;
    XSectionMap[112.5]=23.9401;
    XSectionMap[113]=23.7343;
    XSectionMap[113.5]=23.5312;
    XSectionMap[114]=23.3306;
    XSectionMap[114.5]=23.1325;
    XSectionMap[115]=22.9369;
    XSectionMap[115.5]=22.7442;
    XSectionMap[116]=22.5534;
    XSectionMap[116.5]=22.3651;
    XSectionMap[117]=22.179; 
    XSectionMap[117.5]=21.9949;
    XSectionMap[118]=21.8134;
    XSectionMap[118.5]=21.6341;
    XSectionMap[119]=21.457; 
    XSectionMap[119.5]=21.282; 
    XSectionMap[120]=21.109; 
    XSectionMap[120.5]=20.9381;
    XSectionMap[121]=20.7692;
    XSectionMap[121.5]=20.6023;
    XSectionMap[122]=20.4373;
    XSectionMap[122.5]=20.2742;
    XSectionMap[123]=20.1131;
    XSectionMap[123.5]=19.9538;
    XSectionMap[124]=19.7963;
    XSectionMap[124.5]=19.6407;
    XSectionMap[125]=19.4868;
    XSectionMap[125.5]=19.3347;
    XSectionMap[126]=19.1843;
    XSectionMap[126.5]=19.0357;
    XSectionMap[127]=18.8887;
    XSectionMap[127.5]=18.7433;
    XSectionMap[128]=18.5996;
    XSectionMap[128.5]=18.4574;
    XSectionMap[129]=18.3169;
    XSectionMap[129.5]=18.1778;
    XSectionMap[130]=18.0403;
    XSectionMap[130.5]=17.9043;
    XSectionMap[131]=17.7698;
    XSectionMap[131.5]=17.6368;
    XSectionMap[132]=17.5053;
    XSectionMap[132.5]=17.3752;
    XSectionMap[133]=17.2464;
    XSectionMap[133.5]=17.1191;
    XSectionMap[134]=16.993; 
    XSectionMap[134.5]=16.8683;
    XSectionMap[135]=16.7448;
    XSectionMap[135.5]=16.6226;
    XSectionMap[136]=16.5017;
    XSectionMap[136.5]=16.382; 
    XSectionMap[137]=16.2635;
    XSectionMap[137.5]=16.1463;
    XSectionMap[138]=16.0303;
    XSectionMap[138.5]=15.9155;
    XSectionMap[139]=15.8019;
    XSectionMap[139.5]=15.6894;
    XSectionMap[140]=15.5782;
    XSectionMap[141]=15.3592;
    XSectionMap[142]=15.1446;
    XSectionMap[143]=14.9342;
    XSectionMap[144]=14.7278;
    XSectionMap[145]=14.5253;
    XSectionMap[146]=14.3267;
    XSectionMap[147]=14.1318;
    XSectionMap[148]=13.9404;
    XSectionMap[149]=13.7522;
    XSectionMap[150]=13.5672;
    XSectionMap[151]=13.3852;
    XSectionMap[152]=13.2057;
    XSectionMap[153]=13.0284;
    XSectionMap[154]=12.8527;
    XSectionMap[155]=12.6779;
    XSectionMap[156]=12.5028;
    XSectionMap[157]=12.3256;
    XSectionMap[158]=12.1439;
    XSectionMap[159]=11.9554;
    XSectionMap[160]=11.7624;
    XSectionMap[162]=11.3963;
    XSectionMap[164]=11.0387;
    XSectionMap[166]=10.7032;
    XSectionMap[168]=10.3946;
    XSectionMap[170]=10.1077;
    XSectionMap[172]=9.8376;
    XSectionMap[174]=9.5807;
    XSectionMap[176]=9.3337;
    XSectionMap[178]=9.0926;
    XSectionMap[180]=8.8521;
    XSectionMap[182]=8.6143;
    XSectionMap[184]=8.3939;
    XSectionMap[186]=8.179; 
    XSectionMap[188]=7.9739;
    XSectionMap[190]=7.7803;
    XSectionMap[192]=7.5975;
    XSectionMap[194]=7.4242;
    XSectionMap[196]=7.259; 
    XSectionMap[198]=7.101; 
    XSectionMap[200]=6.9497;
    XSectionMap[202]=6.8042;
    XSectionMap[204]=6.6642;
    XSectionMap[206]=6.5296;
    XSectionMap[208]=6.3999;
    XSectionMap[210]=6.2744;
    XSectionMap[212]=6.1533;
    XSectionMap[214]=6.0364;
    XSectionMap[216]=5.9234;
    XSectionMap[218]=5.8142;
    XSectionMap[220]=5.7085;
    XSectionMap[222]=5.6061;
    XSectionMap[224]=5.5071;
    XSectionMap[226]=5.4112;
    XSectionMap[228]=5.3183;
    XSectionMap[230]=5.2283;
    XSectionMap[232]=5.141; 
    XSectionMap[234]=5.0563;
    XSectionMap[236]=4.974; 
    XSectionMap[238]=4.8944;
    XSectionMap[240]=4.817; 
    XSectionMap[242]=4.7418;
    XSectionMap[244]=4.6689;
    XSectionMap[246]=4.5981;
    XSectionMap[248]=4.5294;
    XSectionMap[250]=4.4627;
    XSectionMap[252]=4.398; 
    XSectionMap[254]=4.3351;
    XSectionMap[256]=4.2741;
    XSectionMap[258]=4.2149;
    XSectionMap[260]=4.1574;
    XSectionMap[262]=4.1016;
    XSectionMap[264]=4.0709;
    XSectionMap[266]=3.9951;
    XSectionMap[268]=3.9442;
    XSectionMap[270]=3.8949;
    XSectionMap[272]=3.8471;
    XSectionMap[274]=3.8009;
    XSectionMap[276]=3.7561;
    XSectionMap[278]=3.7128;
    XSectionMap[280]=3.6709;
    XSectionMap[282]=3.6302;
    XSectionMap[284]=3.591; 
    XSectionMap[286]=3.553; 
    XSectionMap[288]=3.5164;
    XSectionMap[290]=3.4811;
    XSectionMap[295]=3.3986;
    XSectionMap[300]=3.324;
  } else if (HistName.Contains("vbf")) {
    XSectionMap[80.0]=2.410;
    XSectionMap[81.0]=2.384;
    XSectionMap[82.0]=2.360;
    XSectionMap[83.0]=2.336;
    XSectionMap[84.0]=2.311;
    XSectionMap[85.0]=2.289;
    XSectionMap[86.0]=2.265;
    XSectionMap[87.0]=2.243;
    XSectionMap[88.0]=2.221;
    XSectionMap[89.0]=2.199;
    XSectionMap[90.0]=2.176;
    XSectionMap[91.0]=2.154;
    XSectionMap[92.0]=2.133;
    XSectionMap[93.0]=2.112;
    XSectionMap[94.0]=2.090;
    XSectionMap[95.0]=2.071;
    XSectionMap[96.0]=2.050;
    XSectionMap[97.0]=2.030;
    XSectionMap[98.0]=2.010;
    XSectionMap[99.0]=1.991;
    XSectionMap[100.0]=1.971;
    XSectionMap[101.0]=1.952;
    XSectionMap[102.0]=1.934;
    XSectionMap[103.0]=1.915;
    XSectionMap[104.0]=1.897;
    XSectionMap[105.0]=1.878;
    XSectionMap[106.0]=1.860;
    XSectionMap[107.0]=1.843;
    XSectionMap[108.0]=1.826;
    XSectionMap[109.0]=1.808;
    XSectionMap[110.0]=1.791;
    XSectionMap[110.5]=1.783;
    XSectionMap[111.0]=1.775;
    XSectionMap[111.5]=1.766;
    XSectionMap[112.0]=1.758;
    XSectionMap[112.5]=1.750;
    XSectionMap[113.0]=1.742;
    XSectionMap[113.5]=1.733;
    XSectionMap[114.0]=1.725;
    XSectionMap[114.5]=1.717;
    XSectionMap[115.0]=1.709;
    XSectionMap[115.5]=1.701;
    XSectionMap[116.0]=1.693;
    XSectionMap[116.5]=1.686;
    XSectionMap[117.0]=1.678;
    XSectionMap[117.5]=1.670;
    XSectionMap[118.0]=1.661;
    XSectionMap[118.5]=1.654;
    XSectionMap[119.0]=1.647;
    XSectionMap[119.5]=1.639;
    XSectionMap[120.0]=1.632;
    XSectionMap[120.5]=1.624;
    XSectionMap[121.0]=1.617;
    XSectionMap[121.5]=1.609;
    XSectionMap[122.0]=1.602;
    XSectionMap[122.5]=1.595;
    XSectionMap[123.0]=1.588;
    XSectionMap[123.5]=1.580;
    XSectionMap[124.0]=1.573;
    XSectionMap[124.5]=1.566;
    XSectionMap[125.0]=1.559;
    XSectionMap[125.5]=1.552;
    XSectionMap[126.0]=1.544;
    XSectionMap[126.5]=1.539;
    XSectionMap[127.0]=1.531;
    XSectionMap[127.5]=1.524;
    XSectionMap[128.0]=1.517;
    XSectionMap[128.5]=1.511;
    XSectionMap[129.0]=1.504;
    XSectionMap[129.5]=1.497;
    XSectionMap[130.0]=1.490;
    XSectionMap[130.5]=1.483;
    XSectionMap[131.0]=1.477;
    XSectionMap[131.5]=1.470;
    XSectionMap[132.0]=1.463;
    XSectionMap[132.5]=1.458;
    XSectionMap[133.0]=1.451;
    XSectionMap[133.5]=1.444;
    XSectionMap[134.0]=1.439;
    XSectionMap[134.5]=1.432;
    XSectionMap[135.0]=1.425;
    XSectionMap[135.5]=1.419;
    XSectionMap[136.0]=1.413;
    XSectionMap[136.5]=1.407;
    XSectionMap[137.0]=1.401;
    XSectionMap[137.5]=1.395;
    XSectionMap[138.0]=1.388;
    XSectionMap[138.5]=1.382;
    XSectionMap[139.0]=1.376;
    XSectionMap[139.5]=1.370;
    XSectionMap[140.0]=1.365;
    XSectionMap[141.0]=1.352;
    XSectionMap[142.0]=1.341;
    XSectionMap[143.0]=1.329;
    XSectionMap[144.0]=1.317;
    XSectionMap[145.0]=1.306;
    XSectionMap[146.0]=1.295;
    XSectionMap[147.0]=1.284;
    XSectionMap[148.0]=1.272;
    XSectionMap[149.0]=1.261;
    XSectionMap[150.0]=1.251;
    XSectionMap[151.0]=1.240;
    XSectionMap[152.0]=1.229;
    XSectionMap[153.0]=1.218;
    XSectionMap[154.0]=1.208;
    XSectionMap[155.0]=1.197;
    XSectionMap[156.0]=1.187;
    XSectionMap[157.0]=1.176;
    XSectionMap[158.0]=1.166;
    XSectionMap[159.0]=1.155;
    XSectionMap[160.0]=1.146;
    XSectionMap[162.0]=1.136;
    XSectionMap[164.0]=1.123;
    XSectionMap[165.0]=1.115;
    XSectionMap[166.0]=1.106;
    XSectionMap[168.0]=1.088;
    XSectionMap[170.0]=1.070;
    XSectionMap[172.0]=1.052;
    XSectionMap[174.0]=1.035;
    XSectionMap[175.0]=1.026;
    XSectionMap[176.0]=1.017;
    XSectionMap[178.0]=1.000;
    XSectionMap[180.0]=0.982;
    XSectionMap[182.0]=0.967;
    XSectionMap[184.0]=0.9558;
    XSectionMap[185.0]=0.9496;
    XSectionMap[186.0]=0.9429;
    XSectionMap[188.0]=0.9286;
    XSectionMap[190.0]=0.9139;
    XSectionMap[192.0]=0.8998;
    XSectionMap[194.0]=0.8854;
    XSectionMap[195.0]=0.8783;
    XSectionMap[196.0]=0.8714;
    XSectionMap[198.0]=0.8574;
    XSectionMap[200.0]=0.8441;
    XSectionMap[202.0]=0.8309;
    XSectionMap[204.0]=0.8178;
    XSectionMap[206.0]=0.8051;
    XSectionMap[208.0]=0.7927;
    XSectionMap[210.0]=0.7805;
    XSectionMap[212.0]=0.7687;
    XSectionMap[214.0]=0.7568;
    XSectionMap[216.0]=0.7452;
    XSectionMap[218.0]=0.7340;
    XSectionMap[220.0]=0.7229;
    XSectionMap[222.0]=0.7120;
    XSectionMap[224.0]=0.7016;
    XSectionMap[226.0]=0.6913;
    XSectionMap[228.0]=0.6808;
    XSectionMap[230.0]=0.6707;
    XSectionMap[232.0]=0.6610;
    XSectionMap[234.0]=0.6513;
    XSectionMap[236.0]=0.6418;
    XSectionMap[238.0]=0.6326;
    XSectionMap[240.0]=0.6234;
    XSectionMap[242.0]=0.6144;
    XSectionMap[244.0]=0.6056;
    XSectionMap[246.0]=0.5969;
    XSectionMap[248.0]=0.5885;
    XSectionMap[250.0]=0.5802;
    XSectionMap[252.0]=0.5720;
    XSectionMap[254.0]=0.5640;
    XSectionMap[256.0]=0.5562;
    XSectionMap[258.0]=0.5484;
    XSectionMap[260.0]=0.5408;
    XSectionMap[262.0]=0.5333;
    XSectionMap[264.0]=0.5259;
    XSectionMap[266.0]=0.5187;
    XSectionMap[268.0]=0.5116;
    XSectionMap[270.0]=0.5047;
    XSectionMap[272.0]=0.4978;
    XSectionMap[274.0]=0.4910;
    XSectionMap[276.0]=0.4845;
    XSectionMap[278.0]=0.4780;
    XSectionMap[280.0]=0.4715;
    XSectionMap[282.0]=0.4652;
    XSectionMap[284.0]=0.4590;
    XSectionMap[286.0]=0.4530;
    XSectionMap[288.0]=0.4470;
    XSectionMap[290.0]=0.4716;
    XSectionMap[295.0]=0.4562;
    XSectionMap[300.0]=0.4408;
    XSectionMap[305.0]=0.4266;
    XSectionMap[310.0]=0.4131;
    XSectionMap[315.0]=0.3999;
    XSectionMap[320.0]=0.3875;
    XSectionMap[325.0]=0.3753;
    XSectionMap[330.0]=0.3637;
    XSectionMap[335.0]=0.3526;
    XSectionMap[340.0]=0.3422;
    XSectionMap[345.0]=0.3303;
    XSectionMap[350.0]=0.3200;
    XSectionMap[360.0]=0.3028;
    XSectionMap[370.0]=0.2896;
    XSectionMap[380.0]=0.2776;
    XSectionMap[390.0]=0.2660;
    XSectionMap[400.0]=0.2543;
    XSectionMap[420.0]=0.2317;
    XSectionMap[440.0]=0.2103;
    XSectionMap[450.0]=0.1751;
    XSectionMap[460.0]=0.1905;
    XSectionMap[480.0]=0.1724;
    XSectionMap[500.0]=0.1561;
    XSectionMap[520.0]=0.1414;
    XSectionMap[540.0]=0.1283;
    XSectionMap[550.0]=0.1038;
    XSectionMap[560.0]=0.1166;
    XSectionMap[580.0]=0.1062;
    XSectionMap[600.0]=0.09688;
    XSectionMap[620.0]=0.08861;
    XSectionMap[640.0]=0.08121;
    XSectionMap[650.0]=0.06397;
    XSectionMap[660.0]=0.07459;
    XSectionMap[680.0]=0.06865;
    XSectionMap[700.0]=0.06330;
    XSectionMap[720.0]=0.05853;
    XSectionMap[740.0]=0.05420;
    XSectionMap[750.0]=0.04058;
    XSectionMap[760.0]=0.05032;
    XSectionMap[780.0]=0.04682;
    XSectionMap[800.0]=0.04365;
    XSectionMap[820.0]=0.04078;
    XSectionMap[840.0]=0.03815;
    XSectionMap[850.0]=0.02632;
    XSectionMap[860.0]=0.03579;
    XSectionMap[880.0]=0.03363;
    XSectionMap[900.0]=0.03164;
    XSectionMap[920.0]=0.02986;
    XSectionMap[940.0]=0.02820;
    XSectionMap[950.0]=0.01719;
    XSectionMap[960.0]=0.02669;
    XSectionMap[980.0]=0.02524;
    XSectionMap[1000.0]=0.02399;
  } else if (HistName.Contains("wzh")) {
    XSectionMap[90]=2.4997*1.25;
    XSectionMap[95]=2.1268*1.25;
    XSectionMap[100]=1.8173*1.25;
    XSectionMap[105]=1.5629*1.25;
    XSectionMap[110]=1.3475*1.25;
    XSectionMap[110.5]=1.3278*1.25;
    XSectionMap[111]=1.3084*1.25;
    XSectionMap[111.5]=1.2893*1.25;
    XSectionMap[112]=1.2706*1.25;
    XSectionMap[112.5]=1.2522*1.25;
    XSectionMap[113]=1.2343*1.25;
    XSectionMap[113.5]=1.2165*1.25;
    XSectionMap[114]=1.1991*1.25;
    XSectionMap[114.5]=1.1821*1.25;
    XSectionMap[115]=1.1653*1.25;
    XSectionMap[115.5]=1.1491*1.25;
    XSectionMap[116]=1.1331*1.25;
    XSectionMap[116.5]=1.1175*1.25;
    XSectionMap[117]=1.1022*1.25;
    XSectionMap[117.5]=1.0872*1.25;
    XSectionMap[118]=1.0724*1.25;
    XSectionMap[118.5]=1.0579*1.25;
    XSectionMap[119]=1.0437*1.25;
    XSectionMap[119.5]=1.0296*1.25;
    XSectionMap[120]=1.0159*1.25;
    XSectionMap[120.5]=1.0023*1.25;
    XSectionMap[121]=0.9889*1.25;
    XSectionMap[121.5]=0.9756*1.25;
    XSectionMap[122]=0.9626*1.25;
    XSectionMap[122.5]=0.9499*1.25;
    XSectionMap[123]=0.9372*1.25;
    XSectionMap[123.5]=0.9248*1.25;
    XSectionMap[124]=0.9126*1.25;
    XSectionMap[124.5]=0.9005*1.25;
    XSectionMap[125]=0.8887*1.25;
    XSectionMap[125.5]=0.8769*1.25;
    XSectionMap[126]=0.8653*1.25;
    XSectionMap[126.5]=0.8539*1.25;
    XSectionMap[127]=0.8427*1.25;
    XSectionMap[127.5]=0.8316*1.25;
    XSectionMap[128]=0.8207*1.25;
    XSectionMap[128.5]=0.8099*1.25;
    XSectionMap[129]=0.7993*1.25;
    XSectionMap[129.5]=0.7888*1.25;
    XSectionMap[130]=0.7786*1.25;
    XSectionMap[130.5]=0.7685*1.25;
    XSectionMap[131]=0.7586*1.25;
    XSectionMap[131.5]=0.7488*1.25;
    XSectionMap[132]=0.7391*1.25;
    XSectionMap[132.5]=0.7296*1.25;
    XSectionMap[133]=0.7203*1.25;
    XSectionMap[133.5]=0.7111*1.25;
    XSectionMap[134]=0.702*1.25;
    XSectionMap[134.5]=0.6931*1.25;
    XSectionMap[135]=0.6843*1.25;
    XSectionMap[135.5]=0.6756*1.25;
    XSectionMap[136]=0.667*1.25;
    XSectionMap[136.5]=0.6585*1.25;
    XSectionMap[137]=0.6503*1.25;
    XSectionMap[137.5]=0.642*1.25;
    XSectionMap[138]=0.6339*1.25;
    XSectionMap[138.5]=0.626*1.25;
    XSectionMap[139]=0.6182*1.25;
    XSectionMap[139.5]=0.6105*1.25;
    XSectionMap[140]=0.6029*1.25;
    XSectionMap[141]=0.5882*1.25;
    XSectionMap[142]=0.574*1.25;
    XSectionMap[143]=0.5602*1.25;
    XSectionMap[144]=0.5467*1.25;
    XSectionMap[145]=0.5336*1.25;
    XSectionMap[146]=0.5205*1.25;
    XSectionMap[147]=0.5078*1.25;
    XSectionMap[148]=0.4953*1.25;
    XSectionMap[149]=0.4832*1.25;
    XSectionMap[150]=0.4714*1.25;
    XSectionMap[151]=0.4602*1.25;
    XSectionMap[152]=0.4492*1.25;
    XSectionMap[153]=0.4384*1.25;
    XSectionMap[154]=0.4277*1.25;
    XSectionMap[155]=0.4171*1.25;
    XSectionMap[156]=0.4053*1.25;
    XSectionMap[157]=0.3938*1.25;
    XSectionMap[158]=0.3827*1.25;
    XSectionMap[159]=0.3722*1.25;
    XSectionMap[160]=0.3625*1.25;
    XSectionMap[162]=0.3498*1.25;
    XSectionMap[164]=0.3392*1.25;
    XSectionMap[166]=0.3271*1.25;
    XSectionMap[168]=0.313*1.25;
    XSectionMap[170]=0.2989*1.25;
    XSectionMap[172]=0.2862*1.25;
    XSectionMap[174]=0.2742*1.25;
    XSectionMap[176]=0.26262*1.25;
    XSectionMap[178]=0.2516*1.25;
    XSectionMap[180]=0.24127*1.25;
    XSectionMap[182]=0.23239*1.25;
    XSectionMap[184]=0.22416*1.25;
    XSectionMap[186]=0.21581*1.25;
    XSectionMap[188]=0.20718*1.25;
    XSectionMap[190]=0.19896*1.25;
    XSectionMap[192]=0.19139*1.25;
    XSectionMap[194]=0.18426*1.25;
    XSectionMap[196]=0.17733*1.25;
    XSectionMap[198]=0.1706*1.25;
    XSectionMap[200]=0.16416*1.25;
    XSectionMap[202]=0.15804*1.25;
    XSectionMap[204]=0.15221*1.25;
    XSectionMap[206]=0.14665*1.25;
    XSectionMap[208]=0.14133*1.25;
    XSectionMap[210]=0.13625*1.25;
    XSectionMap[212]=0.13135*1.25;
    XSectionMap[214]=0.12666*1.25;
    XSectionMap[216]=0.12218*1.25;
    XSectionMap[218]=0.11788*1.25;
    XSectionMap[220]=0.11377*1.25;
    XSectionMap[222]=0.10984*1.25;
    XSectionMap[224]=0.10607*1.25;
    XSectionMap[226]=0.10246*1.25;
    XSectionMap[228]=0.09898*1.25;
    XSectionMap[230]=0.09566*1.25;
    XSectionMap[232]=0.09244*1.25;
    XSectionMap[234]=0.08934*1.25;
    XSectionMap[236]=0.08635*1.25;
    XSectionMap[238]=0.0835*1.25;
    XSectionMap[240]=0.08074*1.25;
    XSectionMap[242]=0.07809*1.25;
    XSectionMap[244]=0.07555*1.25;
    XSectionMap[246]=0.0731*1.25;
    XSectionMap[248]=0.07075*1.25;
    XSectionMap[250]=0.06848*1.25;
  } else if (HistName.Contains("tth")) {
    XSectionMap[90.0]=0.2162*1.25;
    XSectionMap[95.0]=0.1880*1.25; 	
    XSectionMap[100.0]=0.1638*1.25; 	
    XSectionMap[105.0]=0.1433*1.25; 	
    XSectionMap[110.0]=0.1257*1.25; 	
    XSectionMap[110.5]=0.1241*1.25; 	
    XSectionMap[111.0]=0.1225*1.25; 	
    XSectionMap[111.5]=0.1209*1.25; 	
    XSectionMap[112.0]=0.1194*1.25; 	
    XSectionMap[112.5]=0.1179*1.25; 	
    XSectionMap[113.0]=0.1164*1.25; 	
    XSectionMap[113.5]=0.1149*1.25; 	
    XSectionMap[114.0]=0.1134*1.25; 	
    XSectionMap[114.5]=0.1120*1.25; 	
    XSectionMap[115.0]=0.1106*1.25; 	
    XSectionMap[115.5]=0.1092*1.25; 	
    XSectionMap[116.0]=0.1078*1.25; 	
    XSectionMap[116.5]=0.1065*1.25; 	
    XSectionMap[117.0]=0.1051*1.25; 	
    XSectionMap[117.5]=0.1038*1.25; 	
    XSectionMap[118.0]=0.1025*1.25; 	
    XSectionMap[118.5]=0.1013*1.25; 	
    XSectionMap[119.0]=0.1000*1.25; 	
    XSectionMap[119.5]=0.09878*1.25; 
    XSectionMap[120.0]=0.09756*1.25; 
    XSectionMap[120.5]=0.09636*1.25; 
    XSectionMap[121.0]=0.09518*1.25; 
    XSectionMap[121.5]=0.09402*1.25; 
    XSectionMap[122.0]=0.09287*1.25; 
    XSectionMap[122.5]=0.09174*1.25; 
    XSectionMap[123.0]=0.09063*1.25; 
    XSectionMap[123.5]=0.08954*1.25; 
    XSectionMap[124.0]=0.08846*1.25; 
    XSectionMap[124.5]=0.08739*1.25; 
    XSectionMap[125.0]=0.08634*1.25; 
    XSectionMap[125.5]=0.08530*1.25; 
    XSectionMap[126.0]=0.08428*1.25; 
    XSectionMap[126.5]=0.08327*1.25; 
    XSectionMap[127.0]=0.08227*1.25; 
    XSectionMap[127.5]=0.08129*1.25; 
    XSectionMap[128.0]=0.08032*1.25; 
    XSectionMap[128.5]=0.07937*1.25; 
    XSectionMap[129.0]=0.07842*1.25; 
    XSectionMap[129.5]=0.07750*1.25; 
    XSectionMap[130.0]=0.07658*1.25; 
    XSectionMap[130.5]=0.07568*1.25; 
    XSectionMap[131.0]=0.07479*1.25; 
    XSectionMap[131.5]=0.07391*1.25; 
    XSectionMap[132.0]=0.07304*1.25; 
    XSectionMap[132.5]=0.07219*1.25; 
    XSectionMap[133.0]=0.07135*1.25; 
    XSectionMap[133.5]=0.07052*1.25; 
    XSectionMap[134.0]=0.06970*1.25; 
    XSectionMap[134.5]=0.06890*1.25; 
    XSectionMap[135.0]=0.06810*1.25; 
    XSectionMap[135.5]=0.06731*1.25; 
    XSectionMap[136.0]=0.06654*1.25; 
    XSectionMap[136.5]=0.06577*1.25; 
    XSectionMap[137.0]=0.06502*1.25; 
    XSectionMap[137.5]=0.06428*1.25; 
    XSectionMap[138.0]=0.06355*1.25; 
    XSectionMap[138.5]=0.06282*1.25; 
    XSectionMap[139.0]=0.06211*1.25; 
    XSectionMap[139.5]=0.06141*1.25; 
    XSectionMap[140.0]=0.06072*1.25; 
    XSectionMap[141.0]=0.05937*1.25; 
    XSectionMap[142.0]=0.05807*1.25; 
    XSectionMap[143.0]=0.05680*1.25; 
    XSectionMap[144.0]=0.05556*1.25; 
    XSectionMap[145.0]=0.05435*1.25; 
    XSectionMap[146.0]=0.05316*1.25; 
    XSectionMap[147.0]=0.05200*1.25; 
    XSectionMap[148.0]=0.05087*1.25; 
    XSectionMap[149.0]=0.04976*1.25; 
    XSectionMap[150.0]=0.04869*1.25; 
    XSectionMap[151.0]=0.04765*1.25; 
    XSectionMap[152.0]=0.04663*1.25; 
    XSectionMap[153.0]=0.04564*1.25; 
    XSectionMap[154.0]=0.04468*1.25; 
    XSectionMap[155.0]=0.04374*1.25; 
    XSectionMap[156.0]=0.04283*1.25; 
    XSectionMap[157.0]=0.04194*1.25; 
    XSectionMap[158.0]=0.04108*1.25; 
    XSectionMap[159.0]=0.04024*1.25; 
    XSectionMap[160.0]=0.03942*1.25; 
    XSectionMap[162.0]=0.03783*1.25; 
    XSectionMap[164.0]=0.03632*1.25; 
    XSectionMap[166.0]=0.03488*1.25; 
    XSectionMap[168.0]=0.03350*1.25; 
    XSectionMap[170.0]=0.03219*1.25; 
    XSectionMap[172.0]=0.03094*1.25; 
    XSectionMap[174.0]=0.02975*1.25; 
    XSectionMap[176.0]=0.02862*1.25; 
    XSectionMap[178.0]=0.02755*1.25; 
    XSectionMap[180.0]=0.02652*1.25; 
    XSectionMap[182.0]=0.02553*1.25; 
    XSectionMap[184.0]=0.02459*1.25; 
    XSectionMap[186.0]=0.02370*1.25; 
    XSectionMap[188.0]=0.02286*1.25; 
    XSectionMap[190.0]=0.02206*1.25; 
    XSectionMap[192.0]=0.02128*1.25; 
    XSectionMap[194.0]=0.02052*1.25; 
    XSectionMap[196.0]=0.01981*1.25; 
    XSectionMap[198.0]=0.01913*1.25; 
    XSectionMap[200.0]=0.01849*1.25; 
    XSectionMap[202.0]=0.01787*1.25; 
    XSectionMap[204.0]=0.01727*1.25; 
    XSectionMap[206.0]=0.01670*1.25; 
    XSectionMap[208.0]=0.01615*1.25; 
    XSectionMap[210.0]=0.01562*1.25; 
    XSectionMap[212.0]=0.01512*1.25; 
    XSectionMap[214.0]=0.01463*1.25; 
    XSectionMap[216.0]=0.01417*1.25; 
    XSectionMap[218.0]=0.01373*1.25; 
    XSectionMap[220.0]=0.01330*1.25; 
    XSectionMap[222.0]=0.01289*1.25; 
    XSectionMap[224.0]=0.01251*1.25; 
    XSectionMap[226.0]=0.01213*1.25; 
    XSectionMap[228.0]=0.01178*1.25; 
    XSectionMap[230.0]=0.01143*1.25; 
    XSectionMap[232.0]=0.01110*1.25; 
    XSectionMap[234.0]=0.01077*1.25; 
    XSectionMap[236.0]=0.01046*1.25; 
    XSectionMap[238.0]=0.01016*1.25; 
    XSectionMap[240.0]=0.009873*1.25;
    XSectionMap[242.0]=0.009597*1.25;
    XSectionMap[244.0]=0.009331*1.25;
    XSectionMap[246.0]=0.009076*1.25;
    XSectionMap[248.0]=0.008830*1.25;
    XSectionMap[250.0]=0.008593*1.25;
    XSectionMap[252.0]=0.008363*1.25;
    XSectionMap[254.0]=0.008142*1.25;
    XSectionMap[256.0]=0.007928*1.25;
    XSectionMap[258.0]=0.007722*1.25;
    XSectionMap[260.0]=0.007524*1.25;
    XSectionMap[262.0]=0.007333*1.25;
    XSectionMap[264.0]=0.007149*1.25;
    XSectionMap[266.0]=0.006972*1.25;
    XSectionMap[268.0]=0.006801*1.25;
    XSectionMap[270.0]=0.006636*1.25;
    XSectionMap[272.0]=0.006476*1.25;
    XSectionMap[274.0]=0.006322*1.25;
    XSectionMap[276.0]=0.006173*1.25;
    XSectionMap[278.0]=0.006028*1.25;
    XSectionMap[280.0]=0.005889*1.25;
    XSectionMap[282.0]=0.005754*1.25;
    XSectionMap[284.0]=0.005623*1.25;
    XSectionMap[286.0]=0.005497*1.25;
    XSectionMap[288.0]=0.005374*1.25;
    XSectionMap[290.0]=0.005256*1.25;
    XSectionMap[295.0]=0.004975*1.25;
    XSectionMap[300.0]=0.004719*1.25;
  } else {
    std::cout << "Warning ggh, vbf, wzh, or tth not found in histname!!!!" << std::endl;
    exit(1);
  }

  for (std::map<double, double>::const_iterator iter = XSectionMap.begin();  iter != XSectionMap.end(); ++iter) {
    if (mass==iter->first) return iter->second;
    if (mass>iter->first) {
      double lowmass = iter->first;
      double lowxsec = iter->second;
      ++iter;
      if (mass<iter->first) {
        double highmass = iter->first;
        double highxsec = iter->second;
        double xsec = (highxsec-lowxsec)/(highmass-lowmass)*(mass-lowmass)+lowxsec;
        return xsec;
      }
      --iter;
    }
  }

  std::cout << "Warning cross section outside range of 80-300GeV!!!!" << std::endl;
  exit(1);

}

double GetXsection(double mass) {

  double xsec = GetXsection(mass,"ggh") + GetXsection(mass,"vbf") + GetXsection(mass,"wzh") + GetXsection(mass,"tth");
  return xsec;

}

double GetNorm(double mass1, TH1F* hist1, double mass2, TH1F* hist2, double mass) {

  double br = GetBR(mass);
  double br1 = GetBR(mass1);
  double br2 = GetBR(mass2);
  
  double xsec = GetXsection(mass, hist1->GetName());
  double xsec1 = GetXsection(mass1, hist1->GetName());
  double xsec2 = GetXsection(mass2, hist2->GetName());
  
  double alpha = 1.0*(mass-mass1)/(mass2-mass1);
  double effAcc1 = hist1->Integral()/(xsec1*br1);
  double effAcc2 = hist2->Integral()/(xsec2*br2);

  double Normalization = (xsec*br)*(effAcc1 + alpha * (effAcc2 - effAcc1));
  return Normalization;
  
}

void CheckNorm(double Min, double Max, double Step, TString histname="") {

  vector <double> Mass;
  vector <double> BranchingRatio;
  vector <double> XSection;
  for (double i=Min; i<Max; i+=Step) {
    Mass.push_back(i);
    BranchingRatio.push_back(GetBR(i));
    if (histname=="") XSection.push_back(GetXsection(i));
    else XSection.push_back(GetXsection(i,histname));
  }

  TGraph* BranchGraph = new TGraph(Mass.size(),&Mass[0],&BranchingRatio[0]);
  TGraph* XSectionGraph = new TGraph(Mass.size(),&Mass[0],&XSection[0]);
  BranchGraph->SetTitle("Interpolated Branching Ratios");
  XSectionGraph->SetTitle("Interpolated Cross Sections");
  BranchGraph->SetMarkerStyle(20);
  XSectionGraph->SetMarkerStyle(20);
  BranchGraph->SetMarkerSize(1);
  XSectionGraph->SetMarkerSize(1);

  TCanvas* c1 = new TCanvas("c1","c1",800,650);
  c1->cd();
  BranchGraph->Draw("AP");
  c1->SaveAs("BranchingRatios.png");
  c1->Clear();
  XSectionGraph->Draw("AP");
  c1->SaveAs("XSections.png");

  delete BranchGraph;
  delete XSectionGraph;
  delete c1;

}
